<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <title>CineTrailer | Explora os Melhores Trailers e Estreias</title>
    <meta name="description" content="Descobre os trailers mais recentes, consulta sinopses detalhadas e organiza a tua lista de filmes favorita. A experiência cinematográfica definitiva.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://teusite.com/">

    <meta property="og:type" content="website">
    <meta property="og:title" content="CineTrailer | Explora os Melhores Trailers">
    <meta property="og:description" content="Assiste a trailers e organiza a tua lista de cinema.">
    <meta property="og:image" content="https://teusite.com/assets/og-image.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://image.tmdb.org">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="test.css">
</head>
<body class="sl-theme-light">

    <div class="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="logo"><i class="fas fa-film"></i> taL</div>
            <nav class="user-nav">
                <a href="#" class="active"><i class="fas fa-house"></i> Home</a>
                <a href="#"><i class="fas fa-clapperboard"></i> Meus Filmes</a>
                <a href="#"><i class="fas fa-shopping-cart"></i> Carrinho</a>
                <a href="#"><i class="fas fa-clock-rotate-left"></i> Histórico</a>
                <a href="#"><i class="fas fa-user"></i> Minha Conta</a>
                <a href="#" style="margin-top: auto; color: #ef4444;"><i class="fas fa-right-from-bracket"></i> Sair</a>
            </nav>
        </aside>

        <header class="navbar" aria-label="Barra de navegação principal">
            <div class="nav-top">
                <div class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
                <div class="search-container" aria-label="Barra de pesquisa de filmes">
                    <div class="search-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <input type="text" placeholder="Pesquisar filmes..." aria-label="Campo de pesquisa de filmes">
                    <select class="search-dropdown" aria-label="Pesquisar filmes por:">
                        <option value="title">Título</option>
                        <option value="actor">Ator</option>
                        <option value="year">Ano</option>
                        <option value="date">Data</option>
                        <option value="">Letra</option>
                    </select>
                </div>
                <div class="nav-icons">
                    <div class="cart-wrapper"><i class="fas fa-shopping-basket"></i><span class="cart-count">3</span></div>
                    <i class="fas fa-bell"></i>
                </div>
            </div>
            <div class="categories-bar">
                <span class="cat-item active">Todos</span>
                <span class="cat-item">Ação</span>
                <span class="cat-item">Comédia</span>
                <span class="cat-item">Drama</span>
            </div>
        </header>

        <main class="content" aria-label="Conteúdo principal com seção de destaque e lista de filmes">
            <section class="hero" id="hero-section" aria-label="Seção de destaque com trailer de filme">
                <div id="hero-bg" class="hero-backdrop"></div>
                <div id="player" style="opacity: 0; transition: opacity 0.8s;"></div> 

                <h1 id="hero-title"><div class="skeleton skeleton-title"></div></h1>

                <div class="video-controls-side">
                    <button id="btn-pause" class="side-ctrl" aria-label="Pausar vídeo"><i class="fas fa-pause" aria-hidden="true"></i></button>
                    <button id="btn-audio" class="side-ctrl" aria-label="Ativar ou desativar som"><i class="fas fa-volume-mute" aria-hidden="true"></i></button>
                </div>

                <div class="hero-footer">
                    <div id="hero-overview">
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text" style="width: 80%"></div>
                    </div>
                    <div id="skeleton-btn" class="skeleton skeleton-button"></div>
                    <button class="btn-hero" id="btn-fullscreen" style="display: none;" aria-label="Ativar modo de tela cheia" ><i class="fas fa-eye-low-vision" aria-hidden="true"></i></button>
                </div>
            </section>

            <section class="movie-list" >
                <h2 style="margin-bottom: 1.5rem;" aria-label="Lista de Filmes">Filmes Populares</h2>
                <div class="grid-movies" id="grid-movies">
                    <div class="grid-skeleton"></div>
                    <div class="grid-skeleton"></div>
                    <div class="grid-skeleton"></div>
                    <div class="grid-skeleton"></div>
                </div>
            </section>
        </main>

        <footer class="footer" aria-label="Rodapé do site">
            <p>&copy; 2026 MovieRental Store - Paleta Amber & Sidebar Fixa</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        var player;
        var currentVideoId = '';

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }

        function onYouTubeIframeAPIReady() {
            // A API está pronta, mas aguardamos o ID do TMDB para criar o player
        }

        function createPlayer(videoId) {
            player = new YT.Player('player', {
                height: '100%', width: '100%', videoId: videoId,
                playerVars: { 'autoplay': 1, 'mute': 1, 'controls': 0, 'loop': 1, 'playlist': videoId },
                events: {
                    'onReady': (e) => {
                        e.target.playVideo();
                        document.getElementById('player').style.opacity = "1";
                    },
                    'onStateChange': onPlayerStateChange
                }
            });
            setupHeroControls();
        }

        function onPlayerStateChange(event) {
            const videoEl = document.getElementById('player');
            // Se pausar, mostra o fundo. Se der play, mostra o vídeo.
            if (event.data === YT.PlayerState.PAUSED) {
                videoEl.style.opacity = "0";
            } else if (event.data === YT.PlayerState.PLAYING) {
                videoEl.style.opacity = "1";
            }
        }

        function setupHeroControls() {
            document.getElementById('btn-audio').onclick = function() {
                if (player.isMuted()) {
                    player.unMute();
                    this.innerHTML = '<i class="fas fa-volume-up"></i>';
                } else {
                    player.mute();
                    this.innerHTML = '<i class="fas fa-volume-mute"></i>';
                }
            };

            document.getElementById('btn-pause').onclick = function() {
                if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                    player.pauseVideo();
                    this.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    player.playVideo();
                    this.innerHTML = '<i class="fas fa-pause"></i>';
                }
            };
        }
    </script>

    <script type="module">
        import { getPopularMovies, getMovieTrailer, IMG_URL } from './utils/api.js';

        async function init() {
            try {
                const movies = await getPopularMovies();
                
                if (movies.length > 0) {
                    const featured = movies[0];
                    // Configura a imagem de fundo IMEDIATAMENTE
                    const bgUrl = `https://image.tmdb.org/t/p/original${featured.backdrop_path}`;
                    document.getElementById('hero-bg').style.backgroundImage = `url(${bgUrl})`;
                    
                    document.getElementById('hero-title').innerText = featured.title;
                    document.getElementById('hero-overview').innerText = featured.overview;
                    document.getElementById('skeleton-btn')?.remove();
                    document.getElementById('btn-fullscreen').style.display = 'block';

                    const trailerUrl = await getMovieTrailer(featured.id);
                    if (trailerUrl) {
                        const videoId = trailerUrl.split('embed/')[1].split('?')[0];
                        // Aguarda um pouco para o usuário ver a capa e depois inicia o vídeo
                        setTimeout(() => createPlayer(videoId), 1500);
                    }
                }

                renderGrid(movies);
            } catch (error) { console.error(error); }
        }
// --- SISTEMA DE SOM (Oscilador Premium) ---
const playCartSound = () => {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();

    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    oscillator.type = 'sine'; 
    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
    oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); 

    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.3);
};

// --- SISTEMA DE TOAST (Notificação) ---
function showToast(movieTitle) {
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-cart-arrow-down"></i>
            <span><strong>${movieTitle}</strong> adicionado!</span>
        </div>
    `;
    document.body.appendChild(toast);

    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 500);
    }, 3000);
}

// --- RENDERIZAÇÃO DA GRID ---
function renderGrid(movies) {
    const grid = document.getElementById('grid-movies');
    if (!grid) return;

    grid.innerHTML = movies.map(movie => `
        <div class="movie-card" 
             onmouseenter="playPreview(this, ${movie.id})" 
             onmouseleave="stopPreview(this, ${movie.id})">
            
            <button class="floating-view-btn" onclick="openFullPage(${movie.id})" title="Ver detalhes completos" aria-label="Ver detalhes completos de ${movie.title}">
                Saber mais
            </button>

            <div class="card-visual-container">
                <div class="poster-side">
                    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" 
                         class="card-img" alt="${movie.title}" loading="lazy">
                    <div class="poster-story-overlay">
                        <p class="story-text">${movie.overview ? movie.overview.substring(0, 90) + '...' : 'Sem descrição.'}</p>
                    </div>
                </div>
                <div class="video-preview-side" id="preview-${movie.id}"></div>
            </div>
            
            <div class="card-body">
                <div class="movie-info">
                    <h3 class="movie-title">${movie.title}</h3>
                    <span class="movie-rating">★ ${movie.vote_average.toFixed(1)}</span>
                </div>
                <button class="btn-round add-to-cart"  data-id="${movie.id}" aria-label="Adicionar ${movie.title} ao carrinho">
                    <i class="fas fa-cart-plus"></i>
                </button>
            </div>
        </div>
    `).join('');

    setupGridInteractions();
}

// --- CONFIGURAÇÃO DE CLIQUES (Som + Toast + Contador) ---
function setupGridInteractions() {
    document.querySelectorAll('.add-to-cart').forEach(btn => {
        btn.onclick = (e) => {
            const movieCard = e.target.closest('.movie-card');
            const movieTitle = movieCard.querySelector('.movie-title').innerText;

            // Ativa Som e Toast
            playCartSound(); 
            showToast(movieTitle);
            
            // Contador
            let counter = document.getElementById('cart-counter');
            let count = parseInt(counter.innerText) || 0;
            counter.innerText = count + 1;
            
            // Animação do Botão
            const originalIcon = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i>';
            btn.style.background = '#10b981';
            btn.style.pointerEvents = "none";

            setTimeout(() => {
                btn.innerHTML = originalIcon;
                btn.style.background = ''; 
                btn.style.pointerEvents = "auto";
            }, 1000);
        };
    });
}

// --- LOGICA DE VÍDEO (Direto sem Spin) ---
window.playPreview = async function(el, id) {
    const container = document.getElementById(`preview-${id}`);
    if (!container || container.querySelector('iframe')) return;

    try {
        const videoData = await getMovieTrailer(id); 
        if (videoData) {
            const finalUrl = videoData.includes('http') ? videoData : `https://www.youtube-nocookie.com/embed/${videoData}`;
            
            container.innerHTML = `
                <iframe src="${finalUrl}${finalUrl.includes('?') ? '&' : '?'}autoplay=1&mute=1&controls=0&modestbranding=1&rel=0" 
                        allow="autoplay; encrypted-media" 
                        frameborder="0"></iframe>`;
        }
    } catch (e) {
        console.error("Erro no trailer:", e);
    }
};

window.stopPreview = function(el, id) {
    const container = document.getElementById(`preview-${id}`);
    if (container) container.innerHTML = ''; 
};
        init();
    </script>
</body>
</html>